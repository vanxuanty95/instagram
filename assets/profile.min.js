$(document).ready(function () {
    window.onload = function (e) {
        let urlFiltered = createImageWithFilter(document.getElementById('background_blur_img'))
        $('#background_blur').attr("style", "background-image: url(" + urlFiltered + ")");
        $('#blurbg').attr("style", "background-image: url(" + urlFiltered + ")");
    }

    function createImageWithFilter(imgNode) {
        let canvas = document.createElement('canvas')
        canvas.setAttribute("id", "canvas_temp");
        canvas.width = imgNode.width
        canvas.height = imgNode.height

        let context = canvas.getContext('2d')
        context.filter = getComputedStyle(imgNode).filter

        imgNode.setAttribute('crossOrigin', 'anonymous')

        context.drawImage(imgNode, 0, 0, canvas.width, canvas.height)
        let url = canvas.toDataURL(`image/png`, 0.97)
        return url
    }
});